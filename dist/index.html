<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Viiibe ‚Äì Connect</title>
    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Lato:wght@400;700&family=Playfair+Display:wght@400;700&family=Roboto:wght@400;500;700&family=Space+Mono:wght@400;700&display=swap"
        rel="stylesheet">
  <script type="module" crossorigin>(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const e of i)if(e.type==="childList")for(const r of e.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const e={};return i.integrity&&(e.integrity=i.integrity),i.referrerPolicy&&(e.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?e.credentials="include":i.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function a(i){if(i.ep)return;i.ep=!0;const e=t(i);fetch(i.href,e)}})();const oe={auth:document.getElementById("view-auth"),authorization:document.getElementById("view-authorization"),search:document.getElementById("view-search"),loading:document.getElementById("view-loading"),generating:document.getElementById("view-generating"),moodboard:document.getElementById("view-moodboard"),details:document.getElementById("view-details"),"mini-prd":document.getElementById("view-mini-prd"),confirmation:document.getElementById("view-confirmation")},le=document.getElementById("view-wrapper"),v={moodboard:document.getElementById("tab-moodboard"),colors:document.getElementById("tab-colors"),typography:document.getElementById("tab-typography"),layout:document.getElementById("tab-layout")},B={moodboard:document.getElementById("moodboardGrid"),colors:document.getElementById("section-colors"),typography:document.getElementById("section-typography"),layout:document.getElementById("section-layout")};function M(n){const o=["auth","authorization","search","loading","generating","confirmation"].includes(n);le?.classList.toggle("centered",o),Object.values(oe).forEach(t=>t?.classList.remove("active")),oe[n]?.classList.add("active")}function C(n,o,t){t/=100;const a=o*Math.min(t,1-t)/100,i=e=>{const r=(e+n/30)%12,l=t-a*Math.max(Math.min(r-3,9-r,1),-1);return Math.round(255*l).toString(16).padStart(2,"0")};return`#${i(0)}${i(8)}${i(4)}`.toUpperCase()}function ce(n,o,t){n/=255,o/=255,t/=255;const a=Math.max(n,o,t),i=Math.min(n,o,t);let e=0,r,l=(a+i)/2;if(a===i)e=r=0;else{const m=a-i;switch(r=l>.5?m/(2-a-i):m/(a+i),a){case n:e=(o-t)/m+(o<t?6:0);break;case o:e=(t-n)/m+2;break;case t:e=(n-o)/m+4;break}e/=6}return[e*360,r*100,l*100]}function de(n){const o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return o?{r:parseInt(o[1],16),g:parseInt(o[2],16),b:parseInt(o[3],16)}:{r:0,g:0,b:0}}async function ie(n){const o=Math.min(n.length,6),t=[];for(let g=0;g<o;g++){const f=n[g];if(f.src){const I=await re(f);t.push(...I)}}if(t.length===0)return[];const a=[];t.forEach(g=>{let f=a.find(I=>Math.abs(I.h-g.h)<15);f?(f.pixels.push(g),f.weight+=g.s>30?3:1):a.push({h:g.h,pixels:[g],weight:1})}),a.sort((g,f)=>f.weight-g.weight);let i=a.find(g=>g.pixels.some(f=>f.s>20))||a[0],e=i?i.pixels.reduce((g,f)=>f.s-Math.abs(f.l-50)*.5>g.s-Math.abs(g.l-50)*.5?f:g):{h:200,s:0,l:50};const r=C(e.h,e.s,e.l);let l=a.find(g=>Math.abs(g.h-e.h)>40&&g.pixels.some(f=>f.s>30)),m,d;if(l){const g=l.pixels.reduce((f,I)=>I.s>f.s?I:f);m=C(g.h,g.s,g.l),d=`Accent-Context-${Math.round(g.h)}`}else m=C((e.h+180)%360,85,60),d="Accent-Pop";const h=C((e.h+25)%360,Math.max(10,e.s-20),Math.min(90,e.l+15));return[{role:"Primary",hex:r,primitive:`Brand-${Math.round(e.h)}`},{role:"Secondary",hex:h,primitive:"Brand-Alt"},{role:"Accent",hex:m,primitive:d},{role:"Background",hex:"#FFFFFF",primitive:"Base-White"},{role:"Foreground",hex:"#111111",primitive:"Base-Black"},{role:"Neutral",hex:C(e.h,5,50),primitive:"Neutral-500"},{role:"Border",hex:C(e.h,5,90),primitive:"Neutral-200"},{role:"Success",hex:C(140,70,45),primitive:"Green"},{role:"Warning",hex:C(35,90,55),primitive:"Amber"},{role:"Error",hex:C(0,80,55),primitive:"Red"}]}async function he(){const n=document.getElementById("paletteGrid"),o=document.getElementById("sourceImagesGrid"),t=document.querySelectorAll(".pin-image");if(!n)return;if(t.length===0){n.innerHTML='<p style="grid-column:1/-1; text-align:center; color:#999;">Add images first.</p>',o&&(o.innerHTML="");return}n.innerHTML='<p style="grid-column:1/-1; text-align:center; color:#999;">Analyzing vibes...</p>',o&&(o.innerHTML="");const a=Math.min(t.length,6);if(o)for(let e=0;e<a;e++){const r=t[e];if(r.src){const l=document.createElement("img");l.src=r.src,l.className="source-thumb",o.appendChild(l)}}const i=await ie(t);me(i)}function re(n){return new Promise(o=>{if(!n.src){console.log("üé® Image has no src"),o([]);return}const t=document.createElement("canvas"),a=t.getContext("2d");if(!a)return console.log("üé® Could not get canvas context"),o([]);t.width=50,t.height=50;const i=new Image;i.crossOrigin="Anonymous",i.onload=()=>{try{a.drawImage(i,0,0,50,50);const e=a.getImageData(0,0,50,50).data,r=[];for(let l=0;l<e.length;l+=16){const[m,d,h]=ce(e[l],e[l+1],e[l+2]);h>5&&h<98&&r.push({h:m,s:d,l:h})}o(r)}catch(e){console.error("üé® Canvas error:",e),o([])}},i.onerror=e=>{console.error("üé® Image load error:",e),o([])},i.src=n.src})}function me(n){const o=document.getElementById("paletteGrid");o&&(o.innerHTML="",n.forEach(t=>{const a=document.createElement("div");a.className="role-card";const i=de(t.hex),r=(i.r*299+i.g*587+i.b*114)/1e3>=128?"#000":"#fff";a.innerHTML=`<div class="role-preview" style="background-color:${t.hex}"><div class="contrast-dot" style="background-color:${r}"></div></div><div class="role-info"><span class="role-name">${t.role}</span><span class="role-hex">${t.hex}</span><span class="role-primitive">${t.primitive}</span></div>`,o.appendChild(a)}))}const ge={red:{hMin:345,hMax:15},blue:{hMin:190,hMax:260},green:{hMin:70,hMax:160},lime:{hMin:60,hMax:100},yellow:{hMin:40,hMax:70},orange:{hMin:15,hMax:40},purple:{hMin:260,hMax:300},pink:{hMin:300,hMax:345},cyan:{hMin:160,hMax:190},black:{lMax:25},white:{lMin:80},gray:{sMax:15},dark:{lMax:30},light:{lMin:70},beige:{hMin:20,hMax:50,sMax:40,lMin:50},brown:{hMin:15,hMax:45,lMax:50},colorful:{sMin:35}};async function ue(n,o){const t=ge[o.toLowerCase()];if(!t)return 0;const a=await re(n);if(a.length===0)return 0;let i=0,e=0;return a.forEach(r=>{let l=!0;const m=Math.max(.1,r.s/100*(1-Math.abs(r.l-50)/50));t.sMin!==void 0&&r.s<t.sMin&&(l=!1),t.sMax!==void 0&&r.s>t.sMax&&(l=!1),t.lMin!==void 0&&r.l<t.lMin&&(l=!1),t.lMax!==void 0&&r.l>t.lMax&&(l=!1),t.hMin!==void 0&&t.hMax!==void 0&&(r.s<10?l=!1:t.hMin>t.hMax?r.h>=t.hMin||r.h<=t.hMax||(l=!1):r.h>=t.hMin&&r.h<=t.hMax||(l=!1)),l&&(i+=m),e+=m}),e>0?i/e:0}function pe(){const n=document.getElementById("typographyContent"),t=(document.getElementById("searchInput")?.value||"").toLowerCase();if(!n||n.children.length>1&&!n.innerHTML.includes("Analyzing"))return;n.innerHTML="";const a={modern:{head:{family:"Inter",weight:"700"},body:{family:"Inter",weight:"400"}},elegant:{name:"Editorial Serif",head:{family:"Playfair Display",weight:"700"},body:{family:"Lato",weight:"400"}},tech:{name:"Tech Mono",head:{family:"Space Mono",weight:"700"},body:{family:"Roboto",weight:"400"}},corporate:{name:"Clean Corp",head:{family:"Roboto",weight:"700"},body:{family:"Roboto",weight:"400"}}},i={majorThird:{name:"Major Third",ratio:"1.250"},minorThird:{name:"Minor Third",ratio:"1.200"},perfectFourth:{name:"Perfect Fourth",ratio:"1.333"}};let e=a.modern,r=i.majorThird,l="Balanced contrast.";t.match(/fashion|wedding|luxury|art/)?(e=a.elegant,r=i.perfectFourth,l="High contrast."):t.match(/dashboard|data|crypto|future/)?(e=a.tech,r=i.minorThird,l="Tight hierarchy."):t.match(/bank|corporate|law|finance/)&&(e=a.corporate,r=i.majorThird,l="Standard ratio.");const m=[{role:"Display 3XL",size:"72px",lh:"120%",ls:"-0.02em",font:e.head,weight:e.head.weight,text:"The quick brown fox"},{role:"Display 2XL",size:"56px",lh:"120%",ls:"-0.02em",font:e.head,weight:e.head.weight,text:"The quick brown fox"},{role:"Heading XL",size:"48px",lh:"120%",ls:"-0.02em",font:e.head,weight:e.head.weight,text:"The quick brown fox"},{role:"Heading L",size:"36px",lh:"120%",ls:"-0.02em",font:e.head,weight:e.head.weight,text:"The quick brown fox"},{role:"Heading M",size:"30px",lh:"120%",ls:"-0.02em",font:e.head,weight:e.head.weight,text:"The quick brown fox"},{role:"Heading S",size:"24px",lh:"120%",ls:"-0.02em",font:e.head,weight:e.head.weight,text:"The quick brown fox"},{role:"Heading XS",size:"20px",lh:"150%",ls:"-0.015em",font:e.head,weight:e.head.weight,text:"The quick brown fox"},{role:"Heading 2XS",size:"18px",lh:"150%",ls:"-0.015em",font:e.head,weight:e.head.weight,text:"The quick brown fox"},{role:"Heading 3XS",size:"16px",lh:"150%",ls:"-0.015em",font:e.head,weight:e.head.weight,text:"The quick brown fox"},{isDivider:!0,label:"Body & Paragraphs",role:"",size:"",lh:"",ls:"",font:{family:""},weight:"",text:""},{role:"Body XL",size:"20px",lh:"150%",ls:"-0.015em",font:e.body,weight:e.body.weight,text:"Lorum ipsum dolor sit amet."},{role:"Body L",size:"18px",lh:"150%",ls:"-0.012em",font:e.body,weight:e.body.weight,text:"Lorum ipsum dolor sit amet."},{role:"Body M",size:"16px",lh:"150%",ls:"-0.01em",font:e.body,weight:e.body.weight,text:"Lorum ipsum dolor sit amet."},{role:"Body S",size:"14px",lh:"150%",ls:"-0.005em",font:e.body,weight:400,text:"Metadata info label"}];let d="";m.forEach(h=>{h.isDivider?d+=`<h4 style="font-size:10px; font-weight:600; text-transform:uppercase; color:#bbb; margin:32px 0 8px 0; letter-spacing:1px;">${h.label}</h4>`:d+=`<div class="scale-item"><div class="scale-meta"><span class="scale-role">${h.role}</span><span class="scale-specs">${h.size} / ${h.lh}</span></div><div class="scale-preview" style="font-family:'${h.font.family}'; font-weight:${h.weight}; font-size:${h.size}; line-height:${h.lh}; letter-spacing:${h.ls};">${h.text}</div></div>`}),n.innerHTML=`<div class="font-pair-card" style="margin-bottom:24px; display:grid; grid-template-columns:1fr 1fr 1.3fr; gap:16px; align-items:start; border-top:1px solid #E0E0E0; padding-top:16px;"><div class="font-preview-box"><span class="font-label">Heading</span><div class="font-name" style="font-family:'${e.head.family}'; font-size:13px; font-weight:600; color:#000;">${e.head.family}</div></div><div class="font-preview-box" style="border-left:1px solid #eee; padding-left:16px;"><span class="font-label">Body</span><div class="font-name" style="font-family:'${e.body.family}'; font-size:13px; font-weight:600; color:#000;">${e.body.family}</div></div><div class="font-preview-box" style="border-left:1px solid #eee; padding-left:16px;"><span class="font-label">Scale System</span><div style="font-size:13px; font-weight:600; color:#000;">${r.name} (${r.ratio})</div><div style="font-size:11px; color:#888; line-height:1.3; margin-top:2px;">${l}</div></div></div><div class="scale-list">${d}</div>`}function P(n){[v.moodboard,v.colors,v.typography,v.layout].forEach(o=>o?.classList.remove("active")),[B.moodboard,B.colors,B.typography,B.layout].forEach(o=>o&&(o.style.display="none")),n==="moodboard"?(v.moodboard?.classList.add("active"),B.moodboard&&(B.moodboard.style.display="block")):n==="colors"?(v.colors?.classList.add("active"),B.colors&&(B.colors.style.display="block"),he()):n==="typography"?(v.typography?.classList.add("active"),B.typography&&(B.typography.style.display="block"),pe()):n==="layout"&&(v.layout?.classList.add("active"),B.layout&&(B.style.display="block"))}let z=0;const fe=500;let G=0,S=[],A=!1;function w(n){n<=z||(S.includes(n)||(S.push(n),S.sort((o,t)=>o-t)),se())}function se(){if(S.length===0||A)return;const n=S[0];if(n!==z+1)return;A=!0;const t=Date.now()-G,a=Math.max(0,fe-t);setTimeout(()=>{const e=document.querySelectorAll(".progress-item")[n-1];if(!e){A=!1;return}e.classList.add("active"),setTimeout(()=>{const r=e.querySelector(".checkbox");r&&(r.textContent="‚úì"),e.classList.remove("active"),e.classList.add("completed"),z=n,G=Date.now(),S.shift(),A=!1,n===7?setTimeout(()=>{M("moodboard"),P("moodboard")},2e3):se()},200)},a)}function ye(){z=0,G=Date.now(),S=[],A=!1,document.querySelectorAll(".progress-item").forEach(o=>{o.classList.remove("active","completed");const t=o.querySelector(".checkbox");t&&(t.textContent="‚òê")})}function N(n,o=!1,t){const a=(n||"").trim();if(!a)return;ye(),M("loading"),w(1);const i=document.getElementById("moodboardGrid");i&&(i.innerHTML="",i.style.display="block"),parent.postMessage({pluginMessage:{type:"smart-search",query:a,reload:o,intent:t||null}},"*")}async function F(n){const o=document.getElementById("moodboardGrid");if(!o)return;const t=Array.from(o.querySelectorAll(".pin-image"));let a=0;const i=async()=>{const e=t.filter(r=>r.src&&r.src.length>0);if(e.length>t.length*.5||a>10){console.log(`üé® Starting visual analysis for ${n} on ${e.length} images`);const r=await Promise.all(t.map(async d=>{const h=d.closest(".pin-container");if(!d.src)return{container:h,score:-1,url:""};const g=await ue(d,n),f=d.getAttribute("data-pinterest-url")||"";return{container:h,score:g,url:f}}));r.sort((d,h)=>h.score-d.score);let l=0;const m=[];r.forEach(d=>{d.container&&(d.score>.15?(o.appendChild(d.container),m.push(d.url),l++):d.container.remove())}),window.postMessage({type:"update-lightbox-urls",urls:m},"*"),console.log("üé® Visual sort complete. Visible:",l),w(6),w(7)}else a++,setTimeout(i,500)};setTimeout(i,1e3)}const we="https://moood-refactor.vercel.app/api",be={imageProxy:`${we}/image-proxy`};function ne(n){return`${be.imageProxy}?url=${encodeURIComponent(n)}`}const xe="https://viiibe-backend-fo2xokim1-alberto-contreras-projects-101c33ba.vercel.app/api/chat-gpt";class ve{constructor(){this.conversationHistory=[],this.prd={industry:null,projectType:null,audience:null,styles:[],colors:[],typography:null,intent:null,additionalNotes:null},this.isLoading=!1}getInitialPrompt(){return`Hey! Tell me about the project you're looking for inspiration for. What kind of design references do you need?

For example: 'I need inspiration for a transportation company homepage with red colors and Apple-style design targeting multinational clients.'`}async sendMessage(o){if(this.isLoading)return"Please wait for the current response...";this.isLoading=!0;try{this.conversationHistory.push({role:"user",content:o});const t=await fetch(xe,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:o,history:this.conversationHistory.slice(0,-1)})});if(!t.ok)throw new Error(`API error: ${t.status}`);const a=await t.json();return this.conversationHistory.push({role:"assistant",content:a.reply}),a.prdUpdate&&this.updatePRD(a.prdUpdate),this.isLoading=!1,a.reply}catch(t){return console.error("GPT-4 API error:",t),this.isLoading=!1,"Sorry, I'm having trouble connecting. Please try again."}}updatePRD(o){o.industry&&(this.prd.industry=o.industry),o.projectType&&(this.prd.projectType=o.projectType),o.audience&&(this.prd.audience=o.audience),o.typography&&(this.prd.typography=o.typography),o.intent&&(this.prd.intent=o.intent),o.additionalNotes&&(this.prd.additionalNotes=o.additionalNotes),o.styles&&o.styles.forEach(t=>{this.prd.styles.includes(t)||this.prd.styles.push(t)}),o.colors&&o.colors.forEach(t=>{this.prd.colors.includes(t)||this.prd.colors.push(t)})}isPRDComplete(){return!!(this.prd.industry&&this.prd.projectType&&this.prd.audience&&this.prd.styles.length>0&&this.prd.colors.length>0)}getPRD(){return{...this.prd}}getSummary(){const{industry:o,projectType:t,audience:a,styles:i,colors:e}=this.prd;let r="";return t&&(r+=`${t} `),o&&(r+=`for ${o} `),a&&(r+=`targeting ${a} `),i.length>0&&(r+=`with ${i.join(", ")} style `),e.length>0&&(r+=`using ${e.join(", ")} colors`),r.trim()||"a design project"}generatePRDDocument(){const{industry:o,projectType:t,audience:a,styles:i,colors:e,typography:r,intent:l,additionalNotes:m}=this.prd;let d="";return t&&o?d+=`${t} for ${o}`:t?d+=`${t}`:o&&(d+=`A project for ${o}`),a&&(d+=` targeting ${a}`),i.length>0&&(d+=` with ${i.join(", ")} style`),e.length>0&&(d+=` using ${e.join(", ")} colors`),r&&(d+=` and ${r} typography`),l&&(d+=`. The goal is ${l}`),m&&(d+=`. ${m}`),d||"A design project"}reset(){this.conversationHistory=[],this.prd={industry:null,projectType:null,audience:null,styles:[],colors:[],typography:null,intent:null,additionalNotes:null},this.isLoading=!1}getConversationHistory(){return[...this.conversationHistory]}}function Be(){const n=document.getElementById("styleGuideDrawer"),o=document.getElementById("drawerBackdrop");n&&o&&(o.classList.add("active"),n.classList.add("active"))}function U(){const n=document.getElementById("styleGuideDrawer"),o=document.getElementById("drawerBackdrop");n&&o&&(o.classList.remove("active"),n.classList.remove("active"))}function Me(){return{downloadMoodboard:document.getElementById("toggle-moodboard")?.checked||!1,downloadColorPalette:document.getElementById("toggle-palette")?.checked||!1,downloadTypeScale:document.getElementById("toggle-typography")?.checked||!1,createFigmaStyles:document.getElementById("toggle-styles")?.checked||!1,createFigmaVariables:document.getElementById("toggle-variables")?.checked||!1,createBasicComponents:!1}}async function Ie(){const n=document.querySelectorAll(".pin-image");console.log("üé® [collectAllData] Found image elements:",n.length);const o=[];n.forEach(l=>{if(l.src&&(l.src.startsWith("blob:")||l.src.includes("image-proxy"))){const m=l.getAttribute("data-url");if(l.naturalWidth>0&&l.naturalHeight>0){const d=fetch(l.src).then(h=>h.arrayBuffer()).then(h=>({url:m,bytes:Array.from(new Uint8Array(h)),width:l.naturalWidth,height:l.naturalHeight})).catch(h=>(console.warn("Failed to fetch image:",m,h),null));o.push(d)}}});const t=await Promise.all(o),a=t.filter(l=>l!==null);console.log(`üé® [collectAllData] Collected ${a.length} images (${t.length-a.length} failed)`);let i=[];if(n.length>0)try{console.log("üé® [collectAllData] Calculating palette..."),i=await ie(n),console.log("üé® [collectAllData] Calculated colors:",i.length)}catch(l){console.error("üé® [collectAllData] Error calculating palette:",l)}else console.log("üé® [collectAllData] No images found for palette extraction");const e=[];return document.querySelectorAll(".scale-item").forEach(l=>{const m=l.querySelector(".scale-role")?.textContent,d=l.querySelector(".scale-preview");if(m&&d){const h=window.getComputedStyle(d),g=h.fontSize,f=h.fontFamily,I=h.fontWeight,D=d.textContent;e.push({role:m,size:parseInt(g),font:{family:f.replace(/['"]/g,"")},weight:I,text:D})}}),{images:a,colors:i,typography:e}}document.addEventListener("DOMContentLoaded",function(){v.moodboard&&(v.moodboard.onclick=()=>P("moodboard")),v.colors&&(v.colors.onclick=()=>P("colors")),v.typography&&(v.typography.onclick=()=>P("typography")),v.layout&&(v.layout.onclick=()=>P("layout"));const n=document.getElementById("searchInput"),o=document.getElementById("createMoodboardButton");document.querySelectorAll(".chip").forEach(c=>{c.onclick=()=>{n&&(n.value=c.textContent)}}),o&&(o.onclick=()=>N(n?n.value:"")),n&&(n.onkeydown=c=>{c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),N(n.value))});let t=null;const a=document.getElementById("startMiniPRDButton"),i=document.getElementById("chatInput"),e=document.getElementById("chatSendBtn"),r=document.getElementById("chatMessages");document.getElementById("chatCurrentStep");const l=document.getElementById("backFromChat"),m=document.getElementById("confirmGenerateBtn"),d=document.getElementById("confirmBackBtn");function h(c,s){if(!r)return;const u=document.createElement("div");u.className=`message ${s?"user":"bot"}`;const b=document.createElement("div");b.className="message-avatar",b.textContent=s?"üë§":"üé®";const p=document.createElement("div");p.className="message-bubble",p.textContent=c,u.appendChild(b),u.appendChild(p),r.appendChild(u),r.scrollTop=r.scrollHeight}function g(){if(!r)return;const c=document.createElement("div");c.className="message bot typing-indicator",c.id="typing-indicator";const s=document.createElement("div");s.className="message-avatar",s.textContent="üé®";const u=document.createElement("div");u.className="message-bubble",u.innerHTML='<span class="dot"></span><span class="dot"></span><span class="dot"></span>',c.appendChild(s),c.appendChild(u),r.appendChild(c),r.scrollTop=r.scrollHeight}function f(){const c=document.getElementById("typing-indicator");c&&c.remove()}async function I(){if(!t||!i)return;const c=i.value.trim();if(c){h(c,!0),i.value="",g();try{const s=await t.sendMessage(c);f(),h(s,!1),t.isPRDComplete()&&setTimeout(()=>{showInlinePRDConfirmation()},1e3)}catch(s){f(),h("Sorry, something went wrong. Please try again.",!1),console.error("Chat error:",s)}}}a&&(a.onclick=()=>{t=new ve,r&&(r.innerHTML="");const c=t.getInitialPrompt();h(c,!1);const s=document.querySelector(".chat-progress");s&&(s.style.display="none"),M("mini-prd")}),e&&(e.onclick=I),i&&(i.onkeydown=c=>{c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),I())}),l&&(l.onclick=()=>{M("search"),t=null}),m&&(m.onclick=()=>{if(!t)return;const c=t.getIntent();let s="";c.projectType&&(s+=c.projectType+" "),c.industry&&(s+=c.industry+" "),c.styles.length>0&&(s+=c.styles.join(" ")+" "),c.colors.length>0&&(s+=c.colors.join(" ")+" "),N(s.trim(),!1,c),t=null}),d&&(d.onclick=()=>{M("mini-prd")});const D=document.getElementById("backButton");D&&(D.onclick=()=>{n&&(n.value=""),M("search")});const O=document.getElementById("searchTermsBar");O&&(O.onclick=c=>{if(c.target.closest("#reloadButton"))return;const u=document.getElementById("searchTermsDisplay")?.getAttribute("data-original-query")||"";n&&u&&(n.value=u),M("search")});const W=document.getElementById("reloadButton");W&&(W.onclick=c=>{c.stopPropagation();const u=document.getElementById("searchTermsDisplay")?.getAttribute("data-original-query")||"";u&&(console.log("üîÑ Reloading search with different results..."),N(u,!0))});let y=[],x=-1;const $=document.getElementById("detailsImage");window.onmessage=c=>{const s=c?.data?.pluginMessage;if(s){if(s.type==="show-view"&&(console.log("üì® Received show-view message:",s.view),s.view!=="moodboard"?(console.log("‚úÖ Showing view:",s.view),M(s.view)):console.log("‚è∏Ô∏è Skipping immediate moodboard view (handled by progress)"),s.view==="moodboard"&&s.data)){y=[];const u=document.getElementById("moodboardGrid"),b=document.getElementById("searchTermsDisplay");if(b&&s.data.category){b.setAttribute("data-original-query",s.data.category);const p=s.data.category,T=["minimalist","landing page","red","modern","dashboard","mobile app","ecommerce","saas","portfolio","blog","dark","light","bold","clean","vibrant"];let L=p;T.forEach(Z=>{const E=new RegExp(`\\b(${Z})\\b`,"gi");L=L.replace(E,"<strong>$1</strong>")}),b.innerHTML=L}if(u)if(u.innerHTML="",s.data.pins&&s.data.pins.length>0){let p=0;const T=s.data.pins.length;s.data.pins.forEach((L,Z)=>{const E=L.imageUrl||L.image;if(!E)return;const R=ne(E),j=y.length;y.push(R);const H=document.createElement("div");H.className="pin-container";const k=document.createElement("img");k.className="pin-image",k.setAttribute("data-url",E),k.crossOrigin="Anonymous",k.onload=()=>{p++,console.log(`‚úÖ Image ${p}/${T} loaded: ${E.substring(0,80)}...`),p>=Math.ceil(T*.8)&&(w(4),s.data.intent&&s.data.intent.colors&&s.data.intent.colors.length>0?(w(5),F(s.data.intent.colors[0])):(w(5),w(6),w(7)))},k.onerror=()=>{if(E.includes("/originals/")&&!k.getAttribute("data-fallback-tried")){const ee=E.replace("/originals/","/736x/"),te=ne(ee);console.warn("‚ö†Ô∏è /originals/ failed (403), trying /736x/ fallback..."),console.warn(`   Original: ${E}`),console.warn(`   Fallback: ${ee}`),y[j]=te,k.setAttribute("data-fallback-tried","true"),k.src=te;return}console.error("‚ùå FAILED to load image:"),console.error(`   Original URL: ${E}`),console.error(`   Proxy URL: ${R}`),console.error(`   Pin ID: ${L.id||L.pinId||"unknown"}`),p++,p>=Math.ceil(T*.8)&&(w(4),s.data.intent&&s.data.intent.colors&&s.data.intent.colors.length>0?(w(5),F(s.data.intent.colors[0])):(w(5),w(6),w(7)))},k.src=R;const q=document.createElement("div");q.className="pin-overlay",q.innerHTML='<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>',q.onclick=()=>{x=j,M("details"),$.src=y[j]},H.appendChild(k),H.appendChild(q),u.appendChild(H)}),setTimeout(()=>{p<Math.ceil(T*.8)&&(console.warn(`Timeout: Only ${p}/${T} images loaded, continuing anyway`),w(4),s.data.intent&&s.data.intent.colors&&s.data.intent.colors.length>0?(w(5),F(s.data.intent.colors[0])):(w(5),w(6),w(7)))},1e4)}else u.innerHTML='<p style="text-align:center; width:100%;">No pins found.</p>'}if(s.type==="show-view"&&s.view==="moodboard")setTimeout(()=>{const u=document.querySelector(".fab");u&&(u.onclick=()=>{Be()})},50);else if(s.type==="image-loaded"){const u=URL.createObjectURL(new Blob([s.imageBytes]));if(s.target==="lightbox")$.src=u;else{const p=Array.from(document.querySelectorAll("img[data-pinterest-url]")).find(T=>T.dataset.pinterestUrl===s.url);p&&(p.src=u)}}else s.type==="progress-update"&&w(s.step)}},window.addEventListener("message",c=>{c.data.type==="update-lightbox-urls"&&(y=c.data.urls,console.log("üé® Lightbox URLs updated. New count:",y.length),x>=y.length&&(x=0))});function ae(){const c=document.getElementById("moodboardGrid");if(!c)return;const s=c.querySelectorAll("img"),u=Array.from(s).map(b=>b.complete?Promise.resolve():new Promise(p=>{b.onload=()=>p(),b.onerror=()=>p()}));Promise.all(u).then(()=>{const b=s.length;let p=3;b<=2?p=1:b<=5?p=2:p=3,c.style.columnCount="1",setTimeout(()=>{c.style.columnCount=String(p)},50)})}const X=document.getElementById("detailsCloseBtn");X&&(X.onclick=()=>{M("moodboard"),setTimeout(()=>{ae()},100)});const _=document.getElementById("detailsNextBtn");_&&(_.onclick=()=>{x=(x+1)%y.length,$.src=y[x]});const V=document.getElementById("detailsPrevBtn");V&&(V.onclick=()=>{x=(x-1+y.length)%y.length,$.src=y[x]});const K=document.getElementById("detailsDeleteBtn");K&&(K.onclick=()=>{if(x>-1&&y[x]){const c=y[x],s=document.querySelectorAll(".pin-container");let u=null;s.forEach(b=>{const p=b.querySelector("img.pin-image");p&&p.src===c&&(u=b)}),u&&u.remove(),y.splice(x,1),y.length===0?M("moodboard"):(x>=y.length&&(x=0),$.src=y[x])}});const J=document.getElementById("drawerCloseBtn"),Q=document.getElementById("drawerBackdrop"),Y=document.getElementById("generateStyleGuideBtn");J&&(J.onclick=()=>U()),Q&&(Q.onclick=()=>U()),Y&&(Y.onclick=async()=>{const c=Me();console.log("üé® Style guide configuration:",c),U(),M("generating"),console.log("üé® Collecting style guide data...");const s=await Ie();console.log("üì¶ Data collected:",{images:s.images.length,colors:s.colors.length,typography:s.typography.length}),parent.postMessage({pluginMessage:{type:"generate-full-styleguide",images:s.images,palette:s.colors,typography:s.typography,config:c}},"*")})});</script>
  <style rel="stylesheet" crossorigin>:root{--bg: #FFFFFF;--surface: #F5F5F5;--text-main: #000;--text-sec: #8E8E8E;--border: #E0E0E0}html,body{margin:0;padding:0;width:100%;height:100%;overflow:hidden}*{box-sizing:border-box}body{font-family:Inter,sans-serif;background:var(--bg);color:var(--text-main);-webkit-font-smoothing:antialiased}#view-wrapper{width:100%;height:100vh;display:flex;flex-direction:column;position:relative}.view{position:absolute;inset:0;display:none!important;width:100%;height:100%;flex-direction:column}.view.active{display:flex!important}.view.centered{justify-content:center;align-items:center;padding:24px}.container{width:100%;max-width:720px;margin:0 auto;display:flex;flex-direction:column;align-items:center;text-align:center}.container.welcome{max-width:560px;width:100%;margin:auto}.title{display:flex;align-items:center;justify-content:center;gap:12px;font-size:22px;font-weight:600;margin-bottom:8px}.subtitle{font-size:14px;line-height:1.5;color:gray;margin-bottom:16px;max-width:480px}button{background:#000;color:#fff;border:0;border-radius:8px;font-size:14px;font-weight:600;padding:14px 24px;cursor:pointer;transition:opacity .2s;display:flex;align-items:center;justify-content:center;gap:8px}button:hover{opacity:.85}input[type=text]{width:100%;height:48px;border:1px solid #E6E6E6;border-radius:6px;padding:0 12px;font-size:14px}.row.code{display:flex;gap:8px;width:100%;max-width:440px}.row.code input{flex:1}.search-content{width:100%;max-width:450px;text-align:center}.input-row{display:flex;gap:8px;width:100%;margin-bottom:16px}.input-box{flex:1}.popular-row{display:flex;align-items:center;justify-content:center;gap:12px}.popular-label{font-size:11px;font-weight:600;color:#000000b3}.chips{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}.chip{padding:7px 17px;border-radius:20px;border:1px solid rgba(222,222,222,.6);font-size:11px;cursor:pointer;transition:background .2s}.chip:hover{background:#eee}.container.search-results{justify-content:flex-start;align-items:stretch;text-align:left;height:100%;padding:0;max-width:none}header{display:flex;justify-content:space-between;align-items:flex-end;padding:16px 24px;border-bottom:1px solid #e7e7e7;background:#fff;flex-shrink:0}.header-left{display:flex;align-items:center;gap:12px}.back-btn{width:32px;height:32px;border:1px solid #e7e7e7;border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:pointer}.header-title{font-size:18px;font-weight:600;line-height:1.2}.tabs{display:flex;gap:16px;font-size:12px}.tab{cursor:pointer;padding-bottom:4px;color:#0006;font-weight:500}.tab.active{color:#000;font-weight:600;opacity:1}.grid-scroll{flex:1;overflow-y:auto;padding:24px 32px;position:relative}#moodboardGrid{display:block;column-count:3;column-gap:16px;width:100%;padding-bottom:120px;min-height:300px}.pin-container{display:inline-block;width:100%;margin-bottom:16px;border-radius:12px;background:var(--surface);overflow:hidden;break-inside:avoid;position:relative}.pin-image{display:block;width:100%;height:auto!important;max-height:500px;min-height:100px;object-fit:cover;object-position:top;background-color:#e0e0e0}.pin-overlay{position:absolute;inset:0;background:#0000004d;display:flex;justify-content:center;align-items:center;opacity:0;transition:opacity .2s;cursor:pointer}.pin-container:hover .pin-overlay{opacity:1}.palette-header{display:flex;justify-content:space-between;align-items:center;padding:0 8px;margin-bottom:24px}.palette-title h3{text-align:left;margin:0;font-size:18px}.palette-title p{text-align:left;margin:4px 0 0;font-size:13px;color:var(--text-sec)}.palette-layout{display:flex;gap:24px;width:100%;padding:0 16px;align-items:flex-start}.palette-source{width:25%;min-width:140px;display:flex;flex-direction:column;gap:8px;position:sticky;top:0}.source-title{font-size:11px;font-weight:600;text-transform:uppercase;color:var(--text-sec);margin-bottom:4px}.source-thumbnails{display:grid;grid-template-columns:repeat(auto-fill,minmax(60px,1fr));gap:8px}.source-thumb{width:100%;aspect-ratio:1;object-fit:cover;border-radius:8px;border:1px solid var(--border);opacity:.9}.palette-result{width:75%;flex:1}.palette-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;width:100%;padding-bottom:120px}.role-card{background:#fff;border:1px solid var(--border);border-radius:10px;overflow:hidden;display:flex;flex-direction:column;cursor:pointer;transition:transform .1s}.role-card:hover{border-color:#000}.role-preview{height:70px;width:100%;display:flex;align-items:center;justify-content:center;position:relative}.contrast-dot{width:8px;height:8px;border-radius:50%;background:#fff;opacity:.4}.role-info{padding:10px;text-align:left}.role-name{font-size:11px;font-weight:600;text-transform:uppercase;color:var(--text-sec);margin-bottom:2px;display:block}.role-hex{font-size:14px;font-weight:600;color:var(--text-main);font-family:monospace}.role-primitive{font-size:10px;color:var(--text-sec);margin-top:4px;display:block;opacity:.6}.type-grid{display:flex;flex-direction:column;gap:32px;text-align:left;padding-bottom:120px;padding-left:16px;padding-right:16px}.font-pair-card{display:grid;grid-template-columns:1fr 1fr;gap:24px;border-bottom:1px solid var(--border);padding-bottom:24px;margin-bottom:24px}.font-preview-box{display:flex;flex-direction:column;gap:4px}.font-label{font-size:10px;text-transform:uppercase;letter-spacing:1px;color:var(--text-sec);font-weight:600}.font-name{font-size:20px;font-weight:400;color:var(--text-main)}.scale-list{display:flex;flex-direction:column;gap:0}.scale-item{display:grid;grid-template-columns:100px 1fr;align-items:center;gap:16px;border-bottom:1px solid #f0f0f0;padding:16px 0}.scale-meta{display:flex;flex-direction:column;gap:2px;font-family:monospace;color:var(--text-sec)}.scale-role{font-size:11px;font-weight:600;color:var(--text-main);font-family:Inter,sans-serif;margin-bottom:2px}.scale-specs{font-size:9px;opacity:.7}.scale-preview{color:var(--text-main);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;width:100%}.dummy-content{padding:60px 24px;text-align:center;color:#8e8e8e;background:#fafafa;border-radius:12px;border:2px dashed #E0E0E0;margin-bottom:120px}.dummy-content h3{color:#000;font-size:18px;margin-bottom:8px}.bottom-bar{position:absolute;bottom:0;left:0;right:0;height:100px;background:linear-gradient(360deg,#fff,#fff0);display:flex;align-items:center;justify-content:center;pointer-events:none}.fab{pointer-events:auto;padding:14px 24px;border-radius:8px;background:#000;color:#fff;font-size:14px;font-weight:600;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:opacity .2s ease;border:none}.modal,.lightbox,.spinner-overlay{position:fixed;inset:0;background:#000c;display:none!important;justify-content:center;align-items:center;z-index:1000}.modal.active,.lightbox.active,.spinner-overlay.active{display:flex!important}.modal-content{background:#fff;padding:20px;border-radius:8px;max-width:280px;text-align:center}.modal-buttons{display:flex;gap:10px;justify-content:center;margin-top:15px}.spinner{border:4px solid rgba(255,255,255,.2);border-left-color:#fff;border-radius:50%;width:24px;height:24px;animation:spin 1s linear infinite}@keyframes spin{to{transform:rotate(360deg)}}.container.details{position:fixed;inset:0;z-index:2000;background:#000;padding:0;overflow:hidden;display:block;width:100%;height:100vh}.container.details .panel{width:100%;height:100%;overflow-y:auto;background:transparent;display:block;padding-bottom:0}#detailsImage{display:block;width:100%;height:auto;object-fit:contain;margin:0;padding:0}#detailsCloseBtn{position:fixed;top:20px;right:20px;padding:8px 12px;background:#fff;border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:9999;font-size:12px;font-weight:600}.container.details .bottom-bar{position:fixed;bottom:0;left:0;right:0;height:100px;background:linear-gradient(0deg,#000,#0000);display:flex;align-items:center;justify-content:center;gap:24px;z-index:9999;pointer-events:none}.container.details .circle-btn{pointer-events:auto;width:44px;height:44px;border-radius:50%;background:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:transform .1s}.container.details .circle-btn:active{transform:scale(.95)}.container.details .circle-btn.delete{width:64px;height:64px}.container.details .circle-btn svg{stroke:#000;stroke-width:2;width:24px;height:24px}.toast{position:fixed;bottom:-60px;left:50%;transform:translate(-50%);background-color:#28a745;color:#fff;padding:10px 20px;border-radius:8px;z-index:3000;transition:bottom .5s ease-in-out}.toast.show{bottom:30px}.toast.error{background-color:#dc3545}.drawer-backdrop{position:fixed;inset:0;background:#00000080;z-index:4000;display:none;opacity:0;transition:opacity .3s ease}.drawer-backdrop.active{display:block;opacity:1}.drawer{position:fixed;bottom:0;left:0;right:0;background:#fff;border-radius:16px 16px 0 0;box-shadow:0 -4px 24px #00000026;z-index:4001;transform:translateY(100%);transition:transform .3s ease;max-height:80vh;overflow-y:auto}.drawer.active{transform:translateY(0)}.drawer-header{display:flex;justify-content:space-between;align-items:center;padding:20px 24px;border-bottom:1px solid var(--border);position:sticky;top:0;background:#fff;z-index:1}.drawer-title{font-size:18px;font-weight:600;color:var(--text-main)}.drawer-close{width:32px;height:32px;border-radius:8px;border:1px solid var(--border);display:flex;align-items:center;justify-content:center;cursor:pointer;background:transparent;transition:background .2s}.drawer-close:hover{background:var(--surface)}.drawer-content{padding:24px}.drawer-section{margin-bottom:32px}.drawer-section:last-child{margin-bottom:0}.drawer-section-title{font-size:14px;font-weight:600;color:var(--text-main);margin-bottom:16px}.drawer-option{display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px solid #f5f5f5}.drawer-option:last-child{border-bottom:none}.drawer-option-label{display:flex;align-items:center;gap:8px;font-size:14px;color:var(--text-main)}.drawer-option-label.disabled{color:var(--text-sec);opacity:.6}.chip-soon{display:inline-block;padding:4px 10px;background:#f0f0f0;color:#666;font-size:10px;font-weight:600;text-transform:uppercase;border-radius:12px;letter-spacing:.5px}.toggle-switch{position:relative;width:44px;height:24px;flex-shrink:0}.toggle-switch input{opacity:0;width:0;height:0}.toggle-slider{position:absolute;cursor:pointer;inset:0;background-color:#ccc;border-radius:24px;transition:background-color .2s}.toggle-slider:before{position:absolute;content:"";height:18px;width:18px;left:3px;bottom:3px;background-color:#fff;border-radius:50%;transition:transform .2s}.toggle-switch input:checked+.toggle-slider{background-color:#000}.toggle-switch input:checked+.toggle-slider:before{transform:translate(20px)}.toggle-switch input:disabled+.toggle-slider{background-color:#e0e0e0;cursor:not-allowed;opacity:.5}.drawer-footer{padding:16px 24px;border-top:1px solid var(--border);background:#fff;position:sticky;bottom:0;display:flex;justify-content:flex-end}.drawer-footer button{width:auto}.container.loading{max-width:480px;width:100%;padding:40px 24px;align-items:flex-start;text-align:left}.loading-title{font-size:20px;font-weight:600;color:var(--text-main);margin:0 0 32px;text-align:left;padding-left:4px}.progress-list{display:flex;flex-direction:column;gap:16px;width:100%;text-align:left}.progress-item{display:flex;align-items:flex-start;gap:12px;opacity:.4;transition:opacity .3s ease}.progress-item.active{opacity:1}.progress-item.completed{opacity:.6}.progress-item .checkbox{font-family:monospace;font-size:18px;line-height:1.4;color:var(--text-sec);flex-shrink:0;transition:all .3s ease}.progress-item.completed .checkbox{color:var(--text-main)}.progress-item .text{font-size:14px;line-height:1.6;color:var(--text-main);flex:1}.container.search-agent{max-width:600px;width:100%;padding:0 24px;display:flex;flex-direction:column;align-items:center}.agent-title{font-size:22px;font-weight:600;text-align:center;margin-bottom:20px;color:#000;letter-spacing:-.02em}.agent-input-wrapper{position:relative;width:100%;max-width:480px}.agent-input{width:100%;height:130px;border-radius:24px;border:1px solid transparent;background:#f9f9f9;padding:24px 24px 80px;font-family:Inter,sans-serif;font-size:13px;line-height:1.5;color:#000;resize:none;outline:none;box-shadow:none;transition:all .2s ease}.agent-input:focus{border-color:#eaeaea;box-shadow:none}.agent-input::placeholder{color:#7d7d7d;font-size:13px}.agent-submit-btn{position:absolute;bottom:16px;right:16px;width:40px;height:40px;border-radius:50%;background:transparent;border:none;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:transform .2s ease;padding:0}.agent-submit-btn:hover{transform:scale(1.05);background:transparent}.agent-submit-btn:active{transform:scale(.95)}.search-terms-bar{background:#f9f9f9;padding:16px;margin:0 0 24px;border-radius:8px;display:flex;align-items:baseline;gap:6px;cursor:pointer;transition:background .2s ease;overflow:hidden;text-align:left}.search-terms-bar:hover{background:#f0f0f0}.results-label{font-size:13px;font-weight:600;color:#000;flex-shrink:0}.search-terms-text{font-size:13px;font-style:italic;color:#7d7d7d;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1}.search-terms-text strong{font-weight:600;font-style:italic}.reload-btn{background:transparent;border:none;padding:4px;cursor:pointer;display:flex;align-items:center;justify-content:center;border-radius:4px;transition:all .2s ease;color:#666;flex-shrink:0;margin-left:8px}.reload-btn:hover{background:#e0e0e0;color:#000}.reload-btn:active{transform:rotate(180deg)}.container.generating{max-width:480px;width:100%;padding:40px 24px;text-align:center}.container.generating .spinner{display:inline-block;width:40px;height:40px;border:3px solid #f3f3f3;border-top:3px solid #000;border-radius:50%;animation:spin 1s linear infinite}.generating-message{font-size:13px;line-height:1.6;color:#7d7d7d;margin:0}.mini-prd-cta{margin-top:24px;display:flex;flex-direction:column;align-items:center;gap:12px}.or-divider{font-size:12px;color:#999;text-transform:uppercase;letter-spacing:1px}.btn-mini-prd{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:0;border-radius:12px;font-size:15px;font-weight:600;padding:16px 32px;cursor:pointer;transition:transform .2s,box-shadow .2s;display:flex;align-items:center;gap:8px;box-shadow:0 4px 12px #667eea4d}.btn-mini-prd:hover{transform:translateY(-2px);box-shadow:0 6px 20px #667eea66;opacity:1}.btn-mini-prd:active{transform:translateY(0)}.chat-container{display:flex;flex-direction:column;height:100%;background:#fafafa}.chat-header{display:flex;align-items:center;justify-content:space-between;padding:16px 24px;background:#fff;border-bottom:1px solid #E0E0E0;flex-shrink:0}.back-btn-chat{width:32px;height:32px;display:flex;align-items:center;justify-content:center;cursor:pointer;border-radius:8px;transition:background .2s}.back-btn-chat:hover{background:#f5f5f5}.progress-indicator{font-size:14px;font-weight:600;color:#666}.chat-messages{flex:1;overflow-y:auto;padding:24px;display:flex;flex-direction:column;gap:16px}.message{display:flex;gap:12px;animation:slideIn .3s ease}.message.bot{align-self:flex-start}.message.user{align-self:flex-end;flex-direction:row-reverse}.message-avatar{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,#667eea,#764ba2);display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:16px}.message.user .message-avatar{background:#000}.message-bubble{background:#fff;padding:12px 16px;border-radius:16px;max-width:70%;box-shadow:0 2px 8px #00000014;font-size:14px;line-height:1.5}.message.user .message-bubble{background:#000;color:#fff}.chat-input-container{padding:16px 24px;background:#fff;border-top:1px solid #E0E0E0;display:flex;gap:12px;align-items:flex-end;flex-shrink:0}#chatInput{flex:1;border:1px solid #E0E0E0;border-radius:12px;padding:12px 16px;font-family:Inter,sans-serif;font-size:14px;resize:none;max-height:120px;min-height:44px}#chatInput:focus{outline:none;border-color:#667eea}.send-btn{width:44px;height:44px;border-radius:50%;background:#000;display:flex;align-items:center;justify-content:center;transition:transform .1s,opacity .2s;flex-shrink:0;border:0;cursor:pointer}.send-btn:hover{opacity:.85}.send-btn:active{transform:scale(.95)}.send-btn:disabled{opacity:.4;cursor:not-allowed}@keyframes slideIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.confirmation-content{max-width:500px;text-align:center}.confirmation-icon{font-size:64px;margin-bottom:24px}.confirmation-title{font-size:24px;font-weight:600;margin-bottom:16px}.confirmation-summary{font-size:18px;line-height:1.6;color:#333;margin-bottom:32px}.confirmation-details{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin-bottom:32px}.detail-tag{padding:8px 16px;background:#f5f5f5;border-radius:20px;font-size:13px;font-weight:500;color:#666}.detail-tag.primary{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}.confirmation-actions{display:flex;flex-direction:column;gap:12px}.btn-primary{background:#000;color:#fff;padding:16px 32px;border-radius:12px;font-size:16px;font-weight:600;border:0;cursor:pointer;transition:opacity .2s}.btn-primary:hover{opacity:.85}.btn-secondary{background:transparent;color:#666;padding:12px 24px;border-radius:12px;font-size:14px;font-weight:500;border:1px solid #E0E0E0;cursor:pointer;transition:background .2s}.btn-secondary:hover{background:#f5f5f5}.typing-indicator .message-bubble{display:flex;gap:4px;align-items:center;padding:14px}.typing-indicator .dot{width:8px;height:8px;background:var(--text-sec);border-radius:50%;animation:typingDot 1.4s infinite}.typing-indicator .dot:nth-child(2){animation-delay:.2s}.typing-indicator .dot:nth-child(3){animation-delay:.4s}@keyframes typingDot{0%,60%,to{opacity:.3;transform:translateY(0)}30%{opacity:1;transform:translateY(-4px)}}.prd-confirmation .message-bubble{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:20px;border-radius:16px}.prd-summary{font-size:15px;line-height:1.6;margin-bottom:20px;font-weight:500}.prd-actions{display:flex;flex-direction:column;gap:10px;margin-top:16px}.prd-actions .btn-primary,.prd-actions .btn-secondary{width:100%;padding:12px 20px;border-radius:8px;font-weight:600;font-size:14px;cursor:pointer;transition:all .2s ease;border:none}.prd-actions .btn-primary{background:#fff;color:#667eea}.prd-actions .btn-primary:hover{transform:translateY(-2px);box-shadow:0 4px 12px #00000026}.prd-actions .btn-secondary{background:#fff3;color:#fff;border:1px solid rgba(255,255,255,.3)}.prd-actions .btn-secondary:hover{background:#ffffff4d}</style>
</head>

<body>
    <div id="view-wrapper" class="view-wrapper">
        <!-- SEARCH VIEW (Default) -->
        <div id="view-search" class="view centered active">
            <div class="container search-agent">
                <h1 class="agent-title">What will spark your creativity today?</h1>
                <div class="agent-input-wrapper">
                    <textarea id="searchInput" class="agent-input"
                        placeholder="Describe: &quot;modern red landing, big imagery, strong titles&quot;"></textarea>
                    <button id="createMoodboardButton" class="agent-submit-btn">
                        <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect width="40" height="40" rx="20" fill="black" />
                            <path d="M26 20L14 20M26 20L21 15.5M26 20L21 24.5" stroke="white" stroke-width="1.6"
                                stroke-linecap="round" />
                        </svg>
                    </button>
                </div>

                <!-- MINI-PRD CTA -->
                <div class="mini-prd-cta">
                    <span class="or-divider">or</span>
                    <button type="button" id="startMiniPRDButton" class="btn-mini-prd">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        Crear con Moood! üí¨
                    </button>
                </div>
            </div>
        </div>

        <!-- 3.5 LOADING -->
        <div id="view-loading" class="view centered">
            <div class="container loading">
                <h2 class="loading-title">Creating your mood board</h2>
                <div class="progress-list">
                    <div class="progress-item" data-step="1">
                        <span class="checkbox">‚òê</span>
                        <span class="text">Getting the creative spark you're chasing</span>
                    </div>
                    <div class="progress-item" data-step="2">
                        <span class="checkbox">‚òê</span>
                        <span class="text">Roaming across sources for the good stuff</span>
                    </div>
                    <div class="progress-item" data-step="3">
                        <span class="checkbox">‚òê</span>
                        <span class="text">Giving shape to your Viiibe board</span>
                    </div>
                    <div class="progress-item" data-step="4">
                        <span class="checkbox">‚òê</span>
                        <span class="text">Blending colors and pixels that click</span>
                    </div>
                    <div class="progress-item" data-step="5">
                        <span class="checkbox">‚òê</span>
                        <span class="text">Laying out text styles that read beautifully</span>
                    </div>
                    <div class="progress-item" data-step="6">
                        <span class="checkbox">‚òê</span>
                        <span class="text">Selecting the patterns that truly fit</span>
                    </div>
                    <div class="progress-item" data-step="7">
                        <span class="checkbox">‚òê</span>
                        <span class="text">Ready to go: review and polish your Viiibe board</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 3.6 GENERATING STYLE GUIDE -->
        <div id="view-generating" class="view centered">
            <div class="container generating">
                <div class="spinner" style="margin-bottom: 24px;"></div>
                <p class="generating-message">Putting it all together: color palette, type scale, and a beautiful Viiibe
                    board...</p>
            </div>
        </div>

        <!-- 4. RESULTS -->
        <div id="view-moodboard" class="view">
            <div class="container search-results">
                <header>
                    <div class="header-left">
                        <div id="backButton" class="back-btn" title="Back">
                            <svg width="32" height="32" viewBox="0 0 32 32" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M14.1377 12.3198L10.6963 15.7612H23.0889V16.7612H10.6973L14.1377 20.2017L13.4307 20.9087L8.7832 16.2612L9.13672 15.9077L13.4307 11.6128L14.1377 12.3198Z"
                                    fill="black" />
                            </svg>
                        </div>
                        <div class="header-text">
                            <div class="header-title">Results</div>
                        </div>
                    </div>
                    <div class="tabs">
                        <div id="tab-moodboard" class="tab active">Mood board</div>
                        <div id="tab-colors" class="tab">Color palette</div>
                        <div id="tab-typography" class="tab">Type scale</div>
                        <div id="tab-layout" class="tab">Layout</div>
                    </div>
                </header>

                <div class="grid-scroll">
                    <div id="searchTermsBar" class="search-terms-bar">
                        <span class="results-label">Results for:</span>
                        <span id="searchTermsDisplay" class="search-terms-text"></span>
                        <button id="reloadButton" class="reload-btn" title="Get different results">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M17.5 10C17.5 14.1421 14.1421 17.5 10 17.5C5.85786 17.5 2.5 14.1421 2.5 10C2.5 5.85786 5.85786 2.5 10 2.5C12.0711 2.5 13.9461 3.35714 15.3033 4.75"
                                    stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                                <path d="M15 2.5V5H12.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                    stroke-linejoin="round" />
                            </svg>
                        </button>
                    </div>
                    <div id="moodboardGrid"></div>

                    <!-- Color Palette -->
                    <div id="section-colors" class="section-container" style="display: none;">
                        <div class="palette-header">
                            <div class="palette-title">
                                <h3>System Colors</h3>
                                <p>Semantic roles generated from moodboard.</p>
                            </div>
                        </div>
                        <div class="palette-layout">
                            <div class="palette-source"><span class="source-title">Source Inspiration</span>
                                <div id="sourceImagesGrid" class="source-thumbnails"></div>
                            </div>
                            <div class="palette-result">
                                <div id="paletteGrid" class="palette-grid">
                                    <p style="grid-column:1/-1; text-align:center; color:#999; margin-top:20px;">
                                        Analyzing pixels...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Typography -->
                    <div id="section-typography" class="section-container" style="display: none;">
                        <div class="palette-header" style="margin-bottom: 24px; padding: 0 16px;">
                            <div class="palette-title">
                                <h3 style="margin:0; font-size:18px;">Type Scale</h3>
                                <p style="line-height: 1.5; margin: 4px 0 0 0; color: #8E8E8E; font-size: 13px;">Based
                                    on your moodboard vibe, we suggest a <strong>functional pairing</strong> to start
                                    your system.<br><span style="opacity: 0.7; font-size: 12px;">(Note: We can't detect
                                        exact fonts from images yet, so we provide a solid match for the style).</span>
                                </p>
                            </div>
                        </div>
                        <div id="typographyContent" class="type-grid">
                            <p style="text-align:center; color:#999;">Analyzing style...</p>
                        </div>
                    </div>

                    <!-- Layouts -->
                    <div id="section-layout" class="dummy-content" style="display: none;">
                        <h3>Layouts</h3>
                        <p>Features coming soon...</p>
                    </div>
                </div>

                <div class="bottom-bar">
                    <div class="fab">
                        Generate style guide
                    </div>
                </div>
            </div>
        </div>

        <!-- 5. DETAILS -->
        <div id="view-details" class="view">
            <div class="container details">
                <div class="panel">
                    <div id="detailsCloseBtn" class="chip-close">Done with curation</div>
                    <img id="detailsImage" class="details-image" alt="Preview" />
                    <div class="bottom-bar">
                        <div id="detailsPrevBtn" class="circle-btn"><svg fill="none" viewBox="0 0 24 24">
                                <path d="M15 18L9 12L15 6" stroke="black" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" />
                            </svg></div>
                        <div id="detailsDeleteBtn" class="circle-btn delete"><svg fill="none" viewBox="0 0 24 24">
                                <path
                                    d="M4 7H20M9 3H15M10 11V17M14 11V17M6 7L7 19C7 20.1046 7.89543 21 9 21H15C16.1046 21 17 20.1046 17 19L18 7"
                                    stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </svg></div>
                        <div id="detailsNextBtn" class="circle-btn"><svg fill="none" viewBox="0 0 24 24">
                                <path d="M9 6L15 12L9 18" stroke="black" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" />
                            </svg></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 6. MINI-PRD CHAT VIEW -->
        <div id="view-mini-prd" class="view">
            <div class="chat-container">
                <!-- Header con progreso -->
                <div class="chat-header">
                    <div class="back-btn-chat" id="backFromChat">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M19 12H5M5 12L12 19M5 12L12 5" stroke="black" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </div>
                    <div class="progress-indicator">
                        <span id="chatCurrentStep">1</span>/<span id="chatTotalSteps">6</span>
                    </div>
                </div>

                <!-- Mensajes del chat -->
                <div class="chat-messages" id="chatMessages">
                    <!-- Los mensajes se agregan din√°micamente -->
                </div>

                <!-- Input area -->
                <div class="chat-input-container">
                    <textarea id="chatInput" placeholder="Escribe tu respuesta..." rows="1"></textarea>
                    <button id="chatSendBtn" class="send-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M22 2L11 13M22 2L15 22L11 13M22 2L2 9L11 13" stroke="white" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- 7. CONFIRMATION VIEW -->
        <div id="view-confirmation" class="view centered">
            <div class="container confirmation">
                <div class="confirmation-content">
                    <div class="confirmation-icon">‚ú®</div>
                    <h2 class="confirmation-title">I understand you're looking for:</h2>
                    <p class="confirmation-summary" id="confirmationSummary">
                        <!-- Se llena din√°micamente -->
                    </p>
                    <div class="confirmation-details" id="confirmationDetails">
                        <!-- Se llena din√°micamente con tags -->
                    </div>
                    <div class="confirmation-actions">
                        <button id="confirmGenerateBtn" class="btn-primary">
                            Create Moood! board
                        </button>
                        <button id="confirmBackBtn" class="btn-secondary">
                            Add more info
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- UTILS -->
        <div id="lightbox" class="lightbox">
            <div id="spinnerOverlay" class="spinner-overlay">
                <div class="spinner"></div>
            </div>
            <span id="lightboxClose" class="lightbox-close">&times;</span>
            <button id="lightboxPrev" class="lightbox-nav prev">&lt;</button>
            <img id="lightboxImage" class="lightbox-content">
            <button id="lightboxNext" class="lightbox-nav next">&gt;</button>
            <div class="lightbox-actions"><button id="lightboxDeleteButton" class="danger">Eliminar</button></div>
        </div>
        <div id="confirmModal" class="modal">
            <div class="modal-content">
                <p><strong>¬øQuitar esta imagen del moodboard?</strong></p>
                <div class="modal-buttons"><button id="cancelDeleteButton" class="secondary">Cancelar</button><button
                        id="confirmDeleteButton" class="danger">Quitar</button></div>
            </div>
        </div>
        <div id="toast" class="toast"></div>

        <!-- DRAWER -->
        <div id="drawerBackdrop" class="drawer-backdrop"></div>
        <div id="styleGuideDrawer" class="drawer">
            <div class="drawer-header">
                <div class="drawer-title">Style guide set</div>
                <div id="drawerCloseBtn" class="drawer-close">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 4L4 12M4 4L12 12" stroke="black" stroke-width="2" stroke-linecap="round" />
                    </svg>
                </div>
            </div>
            <div class="drawer-content">
                <!-- Basic Download Section -->
                <div class="drawer-section">
                    <div class="drawer-section-title">Basic download</div>
                    <div class="drawer-option">
                        <div class="drawer-option-label">Download mood board</div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="toggle-moodboard" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="drawer-option">
                        <div class="drawer-option-label">Download color palette</div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="toggle-palette" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="drawer-option">
                        <div class="drawer-option-label">Download type scale</div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="toggle-typography" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <!-- Advanced Download Section -->
                <div class="drawer-section">
                    <div class="drawer-section-title">Advanced download</div>
                    <div class="drawer-option">
                        <div class="drawer-option-label">Create Figma styles</div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="toggle-styles">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="drawer-option">
                        <div class="drawer-option-label">Create Figma variables</div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="toggle-variables">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="drawer-option">
                        <div class="drawer-option-label disabled">
                            Create basic components
                            <span class="chip-soon">Soon</span>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="toggle-components" disabled>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="drawer-footer">
                <button id="generateStyleGuideBtn">Get style guide</button>
            </div>
        </div>
    </div>
</body>

</html>